---
title: "Performance phases"
author: "Pierre Donat-Bouillud"
date: "2023-06-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(readr)
library(stringr)
library(ggplot2)
library(forcats)

here::i_am("analysis/perf-phases.Rmd")

library(here)
```

## Data loading

```{r}
profiles <- read_csv(here("artifacts/results/benchmark_dir-profiles/profiles.csv"))
```

## Basic analysis

```{r}
mean_pc <- summarize(profiles, across(ends_with("-pc"), mean)) %>% unlist %>%
sort(decreasing=TRUE) %>% 
  tibble::enframe(name = "Phase", value = "AvgPc") %>%
  mutate(Phase = str_extract(Phase, "([^-])*"))  # remove the ugly -pc suffix
mean_pc %>%  knitr::kable(digits = 1)
```


```{r, fig.width=8, fig.height=9}
ggplot(mean_pc) +
  geom_col(aes(x=fct_reorder(Phase, AvgPc), y=AvgPc)) +
  coord_flip() +
  labs(y="%")
```

## Weighted rank aggregation


Let's do it more correctly using [weighted rank aggregation](https://cran.r-project.org/web/packages/RankAggreg/vignettes/RankAggreg.pdf):

```{r}
library(RankAggreg) 

# create a matrix of the phases ranked by increasing order of pc 
ranks <- select(profiles, ends_with("-pc"))

# also keep the pc in the same order
```

